"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[1672],{1672:(D,m,r)=>{r.r(m),r.d(m,{ProjectModule:()=>O});var g=r(6814),p=r(707),C=r(8057),l=r(95),b=r(7853),h=r(3714),d=r(8642),x=r(8058),_=r(4220),t=r(4769),u=r(9964),f=r(3530);const k=["projectProgressBar"];function P(a,c){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",18),t.NdJ("click",function(){const o=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.viewTask(o))})("dragstart",function(){const o=t.CHM(e).$implicit,s=t.oxw().$implicit,y=t.oxw();return t.KtG(y.onDragStart(s,o))})("dragend",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.onDragEnd())}),t._uU(2),t.qZA(),t.BQk()}if(2&a){const e=c.$implicit;t.xp6(2),t.hij(" ",e.name," ")}}const v=function(a,c){return{"next-stage-animation":a,"back-stage-animation":c}};function M(a,c){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",14),t.NdJ("dragover",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.allowDrop(n))})("drop",function(){const o=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.onDrop(o))}),t.TgZ(2,"h6",15),t._uU(3),t.TgZ(4,"button",16),t.NdJ("click",function(){const o=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.openTaskDialog(o))}),t.qZA()(),t.TgZ(5,"div",17),t.YNc(6,P,3,1,"ng-container",4),t.qZA()(),t.BQk()}if(2&a){const e=c.$implicit,i=c.index,n=t.oxw();t.xp6(1),t.Q6J("ngClass",t.WLB(3,v,n.nextStageAnimationIndex==i,n.backStageAnimationIndex==i)),t.xp6(2),t.hij(" ",e.name," "),t.xp6(3),t.Q6J("ngForOf",e.tasks)}}function T(a,c){if(1&a){const e=t.EpF();t.TgZ(0,"div",6),t._UZ(1,"input",19)(2,"input",20),t.TgZ(3,"div",9)(4,"p-button",21),t.NdJ("onClick",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.deleteTask())}),t.qZA()()()}if(2&a){const e=t.oxw();t.xp6(1),t.Q6J("readonly",!0)("ngModel",e.taskSelected.name),t.xp6(1),t.Q6J("readonly",!0)("ngModel",e.taskSelected.description)}}let j=(()=>{class a{constructor(e,i,n,o){this._projectService=e,this._cdr=i,this._router=n,this._activatedRoute=o,this.viewingTask=!1,this.stageSelected=null,this.taskSelected=null,this.taskName="",this.taskDescription="",this.showTaskDialog=!1,this.clearHilightedAnimationTimeout=null,this.taskBeingDragged=null,this.stageBeingDragged=null,this.stages=[],this.projectProgressMax=0,this.projectProgressColor="red"}setCurrentProgress(){let e=0;this.stages.forEach((i,n)=>{i.tasks.forEach(o=>{e+=10*n})}),this.projectProgressBar.set(e),this.projectProgressColor=e==this.projectProgressMax?"lightgreen":e>this.projectProgressMax/2?"#ffc732":"red",this._cdr.detectChanges()}onDragStart(e,i){this.stageBeingDragged=e,this.taskBeingDragged=i}onDragEnd(){this.stageBeingDragged=null,this.taskBeingDragged=null}onDrop(e){if(e.id==this.taskBeingDragged.step_id)return;this.clearHilightedAnimationTimeout&&clearTimeout(this.clearHilightedAnimationTimeout);const i=this.stages.findIndex(o=>this.stageBeingDragged.id===o.id),n=this.stages.findIndex(o=>e.id===o.id);n>i?(this.backStageAnimationIndex=null,this.nextStageAnimationIndex=n):(this.nextStageAnimationIndex=null,this.backStageAnimationIndex=n),this.clearHilightedAnimationTimeout=setTimeout(()=>{this.nextStageAnimationIndex=null,this.backStageAnimationIndex=null},1e3),this.taskBeingDragged.step_id=e.id,e.tasks.push(this.taskBeingDragged),this.stageBeingDragged.tasks=this.stageBeingDragged.tasks.filter(o=>o.id!==this.taskBeingDragged.id),this.updateStepTask(this.taskBeingDragged),this.setCurrentProgress()}allowDrop(e){e.preventDefault()}ngOnInit(){this._projectService.load().subscribe({next:()=>{const e=this._projectService.projects.find(i=>i.id==this._activatedRoute.snapshot.params.projectId);e||this._router.navigate(["notfound"]),this.stages=e.steps,this.stages.forEach(i=>{i.tasks.forEach(n=>{this.projectProgressMax+=10*(this.stages.length-1)})}),this.setCurrentProgress()}})}ngAfterViewInit(){this.setCurrentProgress()}ngAfterContentInit(){}openTaskDialog(e){this.showTaskDialog=!0,this.stageSelected=e}closeTaskDialog(){this.taskName="",this.taskDescription="",this.stageSelected=null,this.showTaskDialog=!1}createTask(){this._projectService.saveTask(this.taskName,this.taskDescription,this.stageSelected.project_id,this.stageSelected.id).subscribe({next:()=>{this.closeTaskDialog()}})}viewTask(e){this.taskSelected=e,this.viewingTask=!0}closeViewTask(){this.viewingTask=!1,this.taskSelected=null}deleteTask(){const e=this._projectService.projects.find(n=>n.id==this._activatedRoute.snapshot.params.projectId),i=e.steps.find(n=>n.id==this.taskSelected.step_id);this._projectService.deleteTask(i.id,e.id,this.taskSelected.id).subscribe({next:()=>{this.closeViewTask()}})}updateStepTask(e){const i=this._projectService.projects.find(o=>o.id==this._activatedRoute.snapshot.params.projectId),n=i.steps.find(o=>o.id==e.step_id);this._projectService.updateTask(i.id,n.id,e).subscribe()}static#t=this.\u0275fac=function(i){return new(i||a)(t.Y36(_.Y),t.Y36(t.sBO),t.Y36(d.F0),t.Y36(d.gz))};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-project"]],viewQuery:function(i,n){if(1&i&&t.Gf(k,5),2&i){let o;t.iGM(o=t.CRH())&&(n.projectProgressBar=o.first)}},features:[t._Bn([_.Y,x.F])],decls:17,vars:18,consts:[[1,"progressbar-wrapper"],["direction","ltr+","ease","linear",3,"min","max","spinner","fixed","speed","color"],["projectProgressBar",""],[1,"stages-wrapper"],[4,"ngFor","ngForOf"],["header","Criar tarefa",3,"visible","modal","draggable","resizable","visibleChange"],[2,"width","50vw"],["pInputText","","placeholder","Nome",2,"width","100%",3,"ngModel","ngModelChange"],["pInputText","","placeholder","Descri\xe7\xe3o",2,"width","100%","margin-top","0.5rem","margin-bottom","0.5rem",3,"ngModel","ngModelChange"],[2,"display","flex","justify-content","flex-end","margin-top","0.5rem"],["severity","secondary","label","Cancelar",3,"onClick"],["severity","primary","label","Salvar",3,"onClick"],["header","Tarefa",3,"visible","modal","draggable","resizable","visibleChange"],["style","width: 50vw;",4,"ngIf"],[1,"stage","card",3,"ngClass","dragover","drop"],[2,"display","flex","align-items","center","justify-content","center"],["pButton","","pRipple","","icon","pi pi-plus",1,"p-button-rounded","p-button-sm","p-button-primary","ml-2",2,"padding","0","width","25px","height","25px",3,"click"],[1,"tasks-wrapper"],["draggable","true",1,"task",3,"click","dragstart","dragend"],["pInputText","","placeholder","Nome",2,"width","100%",3,"readonly","ngModel"],["pInputText","","placeholder","Descri\xe7\xe3o",2,"width","100%","margin-top","0.5rem","margin-bottom","0.5rem",3,"readonly","ngModel"],["severity","danger","label","Remover",3,"onClick"]],template:function(i,n){1&i&&(t.TgZ(0,"h5"),t._uU(1,"Projeto Backend"),t.qZA(),t.TgZ(2,"div",0),t._UZ(3,"ng-progress",1,2),t.qZA(),t.TgZ(5,"div",3),t.YNc(6,M,7,6,"ng-container",4),t.qZA(),t.TgZ(7,"p-dialog",5),t.NdJ("visibleChange",function(s){return n.showTaskDialog=s}),t.TgZ(8,"div",6)(9,"input",7),t.NdJ("ngModelChange",function(s){return n.taskName=s}),t.qZA(),t.TgZ(10,"input",8),t.NdJ("ngModelChange",function(s){return n.taskDescription=s}),t.qZA(),t.TgZ(11,"div",9)(12,"p-button",10),t.NdJ("onClick",function(){return n.closeTaskDialog()}),t.qZA(),t._uU(13," \xa0\xa0\xa0 "),t.TgZ(14,"p-button",11),t.NdJ("onClick",function(){return n.createTask()}),t.qZA()()()(),t.TgZ(15,"p-dialog",12),t.NdJ("visibleChange",function(s){return n.viewingTask=s}),t.YNc(16,T,5,4,"div",13),t.qZA()),2&i&&(t.xp6(3),t.Q6J("min",0)("max",n.projectProgressMax)("spinner",!1)("fixed",!1)("speed",500)("color",n.projectProgressColor),t.xp6(3),t.Q6J("ngForOf",n.stages),t.xp6(1),t.Q6J("visible",n.showTaskDialog)("modal",!0)("draggable",!1)("resizable",!1),t.xp6(2),t.Q6J("ngModel",n.taskName),t.xp6(1),t.Q6J("ngModel",n.taskDescription),t.xp6(5),t.Q6J("visible",n.viewingTask)("modal",!0)("draggable",!1)("resizable",!1),t.xp6(1),t.Q6J("ngIf",n.viewingTask))},dependencies:[g.mk,g.sg,g.O5,p.Hq,p.zx,h.o,l.Fj,l.JJ,l.On,u.Yh,f.V],styles:['.layout-main{position:relative}@keyframes _ngcontent-%COMP%_next-stage{0%{box-shadow:0 0 #76b676}75%{box-shadow:0 0 22px #02b202}to{box-shadow:0 0 #76b676}}@keyframes _ngcontent-%COMP%_back-stage{0%{box-shadow:0 0 #b67676}75%{box-shadow:0 0 22px #b20e02}to{box-shadow:0 0 #b67676}}[_nghost-%COMP%]{position:absolute;inset:0;background:var(--surface-card);border:1px solid var(--surface-border);padding:2rem;box-shadow:var(--card-shadow);border-radius:12px;display:flex;flex-direction:column}.progressbar-wrapper[_ngcontent-%COMP%]{position:relative;overflow:hidden;height:5px;z-index:1}.stages-wrapper[_ngcontent-%COMP%]{display:flex;overflow-x:auto;flex-wrap:nowrap;flex:1;padding-top:1rem;padding-bottom:1rem}.stages-wrapper[_ngcontent-%COMP%]   .stage[_ngcontent-%COMP%]{width:300px;min-width:300px;flex:1;margin-bottom:0;padding:.5rem;margin-left:1rem;position:relative}.stages-wrapper[_ngcontent-%COMP%]   .stage[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{text-align:center;padding-bottom:.2rem;margin-bottom:.2rem;border-bottom:solid 1px rgb(239,239,239)}.stages-wrapper[_ngcontent-%COMP%]   .stage[_ngcontent-%COMP%]   .tasks-wrapper[_ngcontent-%COMP%]{max-height:97%;overflow-y:auto}.stages-wrapper[_ngcontent-%COMP%]   .stage[_ngcontent-%COMP%]   .tasks-wrapper[_ngcontent-%COMP%]   .task[_ngcontent-%COMP%]{background-color:#fff;padding:.25rem;cursor:pointer}.stages-wrapper[_ngcontent-%COMP%]   .stage[_ngcontent-%COMP%]   .tasks-wrapper[_ngcontent-%COMP%]   .task[_ngcontent-%COMP%]:hover{background-color:#ebebeb}.stages-wrapper[_ngcontent-%COMP%]   .stage.next-stage-animation[_ngcontent-%COMP%]:before, .stages-wrapper[_ngcontent-%COMP%]   .stage.back-stage-animation[_ngcontent-%COMP%]:before{pointer-events:none;border-radius:1rem;position:absolute;content:"";inset:0}.stages-wrapper[_ngcontent-%COMP%]   .stage.next-stage-animation[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_next-stage infinite 1s}.stages-wrapper[_ngcontent-%COMP%]   .stage.back-stage-animation[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_back-stage infinite 1s}.card[_ngcontent-%COMP%]:nth-child(n){animation-name:_ngcontent-%COMP%_slide-in-left;animation-fill-mode:both;animation-timing-function:cubic-bezier(.25,.46,.45,.94);animation-duration:.5s;animation-delay:0s}.card[_ngcontent-%COMP%]:nth-child(2n){animation-name:_ngcontent-%COMP%_slide-in-left;animation-fill-mode:both;animation-timing-function:cubic-bezier(.25,.46,.45,.94);animation-duration:.5s;animation-delay:.5s}.card[_ngcontent-%COMP%]:nth-child(3n){animation-name:_ngcontent-%COMP%_slide-in-left;animation-fill-mode:both;animation-timing-function:cubic-bezier(.25,.46,.45,.94);animation-duration:.5s;animation-delay:1s}.card[_ngcontent-%COMP%]:nth-child(4n){animation-name:_ngcontent-%COMP%_slide-in-left;animation-fill-mode:both;animation-timing-function:cubic-bezier(.25,.46,.45,.94);animation-duration:.5s;animation-delay:1.5s}.card[_ngcontent-%COMP%]:nth-child(5n){animation-name:_ngcontent-%COMP%_slide-in-left;animation-fill-mode:both;animation-timing-function:cubic-bezier(.25,.46,.45,.94);animation-duration:.5s;animation-delay:2s}.card[_ngcontent-%COMP%]:nth-child(6n){animation-name:_ngcontent-%COMP%_slide-in-left;animation-fill-mode:both;animation-timing-function:cubic-bezier(.25,.46,.45,.94);animation-duration:.5s;animation-delay:2.5s}.card[_ngcontent-%COMP%]:nth-child(7n){animation-name:_ngcontent-%COMP%_slide-in-left;animation-fill-mode:both;animation-timing-function:cubic-bezier(.25,.46,.45,.94);animation-duration:.5s;animation-delay:3s}.card[_ngcontent-%COMP%]:nth-child(8n){animation-name:_ngcontent-%COMP%_slide-in-left;animation-fill-mode:both;animation-timing-function:cubic-bezier(.25,.46,.45,.94);animation-duration:.5s;animation-delay:3.5s}.card[_ngcontent-%COMP%]:nth-child(9n){animation-name:_ngcontent-%COMP%_slide-in-left;animation-fill-mode:both;animation-timing-function:cubic-bezier(.25,.46,.45,.94);animation-duration:.5s;animation-delay:4s}.card[_ngcontent-%COMP%]:nth-child(10n){animation-name:_ngcontent-%COMP%_slide-in-left;animation-fill-mode:both;animation-timing-function:cubic-bezier(.25,.46,.45,.94);animation-duration:.5s;animation-delay:4.5s}@keyframes _ngcontent-%COMP%_slide-in-left{0%{transform:translate(-1000px);opacity:0}to{transform:translate(0);opacity:1}}']})}return a})(),w=(()=>{class a{static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275mod=t.oAB({type:a});static#n=this.\u0275inj=t.cJS({imports:[d.Bz.forChild([{path:"",component:j}]),d.Bz]})}return a})(),O=(()=>{class a{static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275mod=t.oAB({type:a});static#n=this.\u0275inj=t.cJS({imports:[g.ez,w,p.hJ,C.nD,h.j,l.u5,b.gz,u.Q8,f.S]})}return a})()}}]);